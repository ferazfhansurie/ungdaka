/* Oil mask animation styles */
.product-image {
    position: relative;
    overflow: hidden;
}

.product-image[data-animated="true"]::before,
.product-image[data-animated="true"] > img::before,
.image-zoom-container[data-animated="true"]::before,
.image-zoom-container[data-animated="true"] > img::before,
.product-detail-image[data-animated="true"]::before,
.product-detail-image[data-animated="true"] > img::before {
    /* The oil layer is masked to the alpha of the product image using CSS masks.
       JS will set --mask-url to the product image src so the oil only shows where
       the product is opaque. */
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    /* Keep bright yellow/amber colors but use layered gradients to simulate oil texture.
       Base color stays vivid; additional layers provide subtle flow, sheen and micro-variations. */
    background:
        /* bright amber base */
        radial-gradient(circle at 50% 60%, rgba(255, 215, 0, 0.95) 0%, rgba(255, 170, 20, 0.9) 40%, rgba(210,110,20,0.75) 75%, transparent 100%),
        /* larger soft sheen band */
        linear-gradient(100deg, rgba(255,255,255,0.12) 0%, rgba(255,255,255,0.02) 12%, rgba(255,255,255,0) 20%),
        /* tiny specular streaks that animate via background-position */
        radial-gradient(circle at 25% 30%, rgba(255,240,180,0.06) 0%, transparent 18%),
        radial-gradient(circle at 75% 70%, rgba(255,200,110,0.06) 0%, transparent 16%);
    will-change: transform, opacity, background-position;
    /* Use multiply so oil darkens underlying colors; sheen delivered via ::after */
    mix-blend-mode: multiply;
    /* Shorter, less expensive animations */
    animation:
        oilMaskReveal 1.6s cubic-bezier(0.23, 0.0, 0.2, 1) forwards,
        oilBubble 2.4s ease-in-out infinite alternate; /* slower, smoother bubble motion */
    pointer-events: none;
    z-index: 2;

    /* Use the product image as a mask. JS will set --mask-url to the image src.
       Provide both standard and WebKit-prefixed properties for wide support. */
    mask-image: var(--mask-url, none);
    mask-size: var(--mask-size, cover);
    mask-position: var(--mask-position, center);
    mask-repeat: no-repeat;

    -webkit-mask-image: var(--mask-url, none);
    -webkit-mask-size: var(--mask-size, cover);
    -webkit-mask-position: var(--mask-position, center);
    -webkit-mask-repeat: no-repeat;
}

.product-image[data-animated="true"]::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    /* Specular sheen layer: thinner, lower-opacity highlights that drift across the surface */
    background: linear-gradient(120deg, rgba(255,255,255,0.14) 0%, rgba(255,255,255,0.04) 8%, rgba(255,255,255,0) 18%),
                linear-gradient(60deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.03) 8%, rgba(255,255,255,0) 16%);
    animation: oilSheen 4.2s linear infinite;
    mix-blend-mode: screen;
    z-index: 4;
}

/* subtle sheen motion */
@keyframes oilSheen {
    0% { background-position: -30% 0%, 140% 0%; opacity: 0.85; }
    50% { background-position: 10% 0%, 100% 0%; opacity: 1; }
    100% { background-position: 40% 0%, 60% 0%; opacity: 0.88; }
}

.product-image[data-animated="true"] img {
    opacity: 0;
    /* reveal quicker to reduce perceived lag */
    animation: productReveal 580ms cubic-bezier(0.4, 0, 0.2, 1) forwards;
    animation-delay: 700ms; /* Start revealing sooner */
}

@keyframes oilMaskReveal {
    /* Stage 1: tiny seed (brewing) */
    0% {
        clip-path: circle(1% at 50% 50%);
        transform: scale(0.22) rotate(-6deg);
        opacity: 0;
        filter: blur(3px) brightness(1.6) saturate(1);
        background-position: 0% 0%, 0% 0%, 0% 0%, 0% 0%;
    }
    /* Stage 2: small blobs appear */
    18% {
        clip-path: circle(8% at 46% 54%);
        transform: scale(0.48) rotate(-3deg);
        opacity: 0.26;
        filter: blur(2.6px) brightness(1.35) saturate(1.03);
    }
    /* Stage 3: blobs grow and bubble */
    38% {
        clip-path: circle(22% at 46% 54%);
        transform: scale(0.78) rotate(2deg);
        opacity: 0.88;
        filter: blur(1.6px) brightness(1.18) saturate(1.06);
        background-position: 6% 4%, 0% 0%, 18% 28%, 72% 78%;
    }
    /* Stage 4: coalescence - spread across the product silhouette */
    62% {
        clip-path: circle(60% at 50% 50%);
        transform: scale(0.98) rotate(-0.4deg);
        opacity: 0.98;
        filter: blur(0.9px) brightness(1.06) saturate(1.07);
    }
    /* Stage 5: peak, then start to fade/clear */
    86% {
        clip-path: circle(110% at 50% 50%);
        transform: scale(1.02) rotate(0.2deg);
        opacity: 0.5;
        filter: blur(0.7px) brightness(1.03) saturate(1.02);
    }
    /* End: dissipate */
    100% {
        clip-path: circle(150% at 50% 50%);
        transform: scale(1.03) rotate(0deg);
        opacity: 0;
        filter: blur(0px) brightness(1) saturate(1);
    }
}

@keyframes oilBubble {
    0% {
        background-position: 0% 0%, 100% 100%;
        filter: blur(2px) brightness(1.15);
    }
    100% {
        background-position: 8% 8%, 92% 92%;
        filter: blur(3px) brightness(1.25);
    }
}

@keyframes oilSwirl {
    0% { transform: scale(1) rotate(0deg); opacity: 0.45; }
    50% { transform: scale(1.05) rotate(180deg); opacity: 0.6; }
    100% { transform: scale(1) rotate(360deg); opacity: 0.45; }
}

@keyframes productReveal {
    0% { opacity: 0; transform: scale(0.96) translateY(6px); }
    100% { opacity: 1; transform: scale(1) translateY(0); }
}

/* SVG Filters */
.product-filters {
    position: absolute;
    width: 0;
    height: 0;
    pointer-events: none;
}

/* Normalize product image containers so all product cards have consistent sizing
   This ensures masks align and product thumbnails appear uniform across the grid.
   You can override the defaults by setting the CSS variables on the page or
   on specific cards: --product-image-height, --product-image-padding */
.product-card .product-image {
    height: var(--product-image-height, 520px) !important;
    padding: var(--product-image-padding, 30px) !important;
    box-sizing: border-box;
    display: flex;
    align-items: center;
    justify-content: center;
}

.product-card .product-image img {
    /* Keep image contained within the container and centered */
    max-width: 100% !important;
    max-height: 100% !important;
    width: auto !important;
    height: auto !important;
    display: block;
    margin: 0 auto;
}

/* Desktop: ensure featured products in the hero/featured section have uniform large sizing */
@media (min-width: 769px) {
    .featured-products .product-card .product-image {
        height: 600px !important;
        padding: 40px !important;
    }

    .featured-products .product-card .product-image img {
        width: 100% !important;
        height: 100% !important;
        object-fit: contain !important;
    }
}

    /* Add spacing for the featured products CTA button */
    .featured-products .products-cta {
        margin-top: 28px !important;
        text-align: center;
    }

    .featured-products .products-cta .btn-modern {
        margin-top: 12px !important;
        padding: 12px 22px !important;
    }

    /* Add more top padding to the industries carousel section */
    .industries-carousel-section {
        padding-top: 64px !important;
    }

/* Apply same oil overlay to category tiles on the products index */
.category-card .category-image {
    position: relative;
    overflow: hidden;
}

.category-card[data-animated="true"] .category-image::before,
.category-card[data-animated="true"] .category-image::after {
    /* Reuse the same visual layers as product images by inheriting the product-image rules.
       We duplicate minimal properties to avoid reliance on complex selector ordering. */
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 2;
}

/* Use the same sheen and mask behavior as product images */
.category-card[data-animated="true"] .category-image::before {
    background: inherit; /* will be set by the JS overlay/mask logic */
    mix-blend-mode: multiply;
    animation: oilMaskReveal 1.6s cubic-bezier(0.23, 0.0, 0.2, 1) forwards, oilBubble 2.4s ease-in-out infinite alternate;
    mask-image: var(--mask-url, none);
    mask-size: var(--mask-size, cover);
    mask-position: var(--mask-position, center);
    -webkit-mask-image: var(--mask-url, none);
    -webkit-mask-size: var(--mask-size, cover);
    -webkit-mask-position: var(--mask-position, center);
}

.category-card[data-animated="true"] .category-image::after {
    background: linear-gradient(120deg, rgba(255,255,255,0.14) 0%, rgba(255,255,255,0.04) 8%, rgba(255,255,255,0) 18%),
                linear-gradient(60deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.03) 8%, rgba(255,255,255,0) 16%);
    animation: oilSheen 4.2s linear infinite;
    mix-blend-mode: screen;
    z-index: 4;
}

/* Oil droplet elements used to build the product in stages */
.product-image .oil-droplet {
    position: absolute;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: radial-gradient(circle at 40% 35%, rgba(255,230,120,0.95) 0%, rgba(255,160,40,0.95) 40%, rgba(200,140,30,0.9) 70%, rgba(0,0,0,0) 100%);
    transform: scale(0) translateZ(0);
    opacity: 0;
    pointer-events: none;
    z-index: 1; /* under the coalescing ::before overlay (which is z-index:2) */
    will-change: transform, opacity;
}

@keyframes dropletPop {
    0% {
        transform: scale(0) translateY(6px);
        opacity: 0;
        filter: blur(6px);
    }
    40% {
        transform: scale(1.05) translateY(-4px);
        opacity: 1;
        filter: blur(2px);
    }
    70% {
        transform: scale(0.9) translateY(0);
        opacity: 0.9;
        filter: blur(1px);
    }
    100% {
        transform: scale(1.6) translateY(-6px);
        opacity: 0.75;
        filter: blur(0px);
    }
}

/* Utility class to trigger the pop animation; animation-delay set inline by JS */
.product-image .oil-droplet.pop {
    animation: dropletPop 700ms cubic-bezier(0.22, 1, 0.36, 1) forwards;
}

/* Mobile: show one featured product card at a time and make its image larger */
@media (max-width: 768px) {
    /* the featured products section uses .products-grid on index.html */
    .featured-products .products-grid {
        grid-template-columns: 1fr !important;
        gap: 20px !important;
        max-width: 100% !important;
        padding: 0 12px !important;
        display: grid !important;
    }

    .featured-products .product-card {
        display: block !important;
        width: 100% !important;
        margin: 0 auto !important;
    }

    .featured-products .product-card .product-image {
        height: 420px !important; /* larger image area on mobile */
        padding: 24px !important;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .featured-products .product-card .product-image img {
        width: 100% !important;
        height: 100% !important;
        object-fit: contain !important;
        max-height: none !important;
    }

    /* Slightly enlarge product title for emphasis */
    .featured-products .product-info h3 {
        font-size: 1.15rem;
    }

    /* Reduce product description clutter on very small screens */
    .featured-products .product-info p {
        display: block;
        font-size: 0.95rem;
        line-height: 1.2;
        margin-top: 6px;
    }
}

/* Hide Food Grade images on mobile to reduce clutter */
@media (max-width: 768px) {
    .food-grade-section .food-image-grid,
    .food-grade-section .food-image-card,
    .food-grade-section .food-image-card img {
        display: none !important;
    }
    /* If needed, keep the section header visible */
    .food-grade-section .section-header {
        margin-bottom: 16px !important;
    }
}
